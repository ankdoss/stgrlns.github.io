<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Academy - Learn & Practice</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            min-height: 100vh;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin: 0;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            background-size: 300% 300%;
            animation: gradient 3s ease infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        @keyframes gradient {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .video-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: fit-content;
        }

        .video-section h3 {
            color: #ff6b6b;
            margin-top: 0;
            text-align: center;
            font-size: 1.4em;
            margin-bottom: 20px;
        }

        .video-container {
            position: relative;
            width: 100%;
            height: 200px;
            background: #1a1a2e;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .video-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(45deg, #1a1a2e, #16213e);
            position: relative;
        }

        .play-button {
            width: 60px;
            height: 60px;
            background: rgba(255, 107, 107, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .play-button:hover {
            background: rgba(255, 107, 107, 1);
            transform: scale(1.1);
        }

        .play-button::after {
            content: '';
            width: 0;
            height: 0;
            border-left: 20px solid white;
            border-top: 12px solid transparent;
            border-bottom: 12px solid transparent;
            margin-left: 4px;
        }

        .video-title {
            font-size: 16px;
            font-weight: bold;
            color: #4ecdc4;
            margin-bottom: 10px;
        }

        .video-description {
            font-size: 13px;
            line-height: 1.4;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 20px;
            max-height: 80px;
            overflow-y: auto;
        }

        .video-list {
            max-height: 300px;
            overflow-y: auto;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
        }

        .video-item {
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
        }

        .video-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #4ecdc4;
        }

        .video-item.active {
            background: rgba(78, 205, 196, 0.2);
            border-color: #4ecdc4;
        }

        .video-item-title {
            font-size: 14px;
            font-weight: bold;
            color: #96ceb4;
            margin-bottom: 4px;
        }

        .video-item-duration {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
        }

        .pattern-badge {
            display: inline-block;
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            margin-top: 4px;
        }

        .chart-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chart-wrapper {
            position: relative;
            height: 500px;
        }

        #stockChart {
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            background: #1a1a2e;
            width: 100%;
            height: 100%;
        }

        .trading-panel {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: fit-content;
        }

        .trading-panel h3 {
            color: #4ecdc4;
            margin-top: 0;
            text-align: center;
            font-size: 1.5em;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #96ceb4;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 16px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        .input-group input:focus {
            outline: none;
            border-color: #4ecdc4;
        }

        .input-group input[type="number"]::-webkit-outer-spin-button,
        .input-group input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .input-group input[type="number"] {
            -moz-appearance: textfield;
        }

        .current-price {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .current-price .price {
            font-size: 24px;
            font-weight: bold;
            color: #4ecdc4;
        }

        .current-price .time {
            font-size: 14px;
            color: #96ceb4;
            margin-top: 5px;
        }

        .invest-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-bottom: 20px;
        }

        .invest-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .invest-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .trade-status {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }

        .pnl {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }

        .profit {
            color: #4ecdc4;
        }

        .loss {
            color: #ff6b6b;
        }

        .neutral {
            color: #ffd93d;
        }

        .game-controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .control-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #4ecdc4;
        }

        .pattern-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .pattern-info h4 {
            color: #4ecdc4;
            margin-top: 0;
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px;
            border-radius: 8px;
            pointer-events: none;
            font-size: 12px;
            z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: none;
        }

        .trade-summary {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 14px;
        }

        .simulation-speed {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .speed-btn {
            padding: 8px 15px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .speed-btn.active {
            background: #4ecdc4;
            border-color: #4ecdc4;
        }

        #bearishBtn.speed-btn.active {
            background: #ff6b6b !important;
            border-color: #ff6b6b !important;
            color: #fff !important;
        }

        .final-result {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #4ecdc4;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            z-index: 10000;
            min-width: 400px;
            display: none;
        }

        .result-title {
            font-size: 2em;
            margin-bottom: 20px;
        }

        .result-pnl {
            font-size: 3em;
            font-weight: bold;
            margin: 20px 0;
        }

        .progress-indicator {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            text-align: center;
        }

        .progress-step {
            display: inline-block;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin: 0 5px;
            line-height: 30px;
            font-size: 12px;
            font-weight: bold;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
        }

        .progress-step.completed {
            background: #4ecdc4;
            border-color: #4ecdc4;
        }

        .progress-step.active {
            background: #ff6b6b;
            border-color: #ff6b6b;
        }

        .video-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            z-index: 20000;
            align-items: center;
            justify-content: center;
        }

        .video-modal-content {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            max-width: 800px;
            width: 90%;
            max-height: 90%;
            overflow-y: auto;
        }

        .video-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-modal {
            background: #ff6b6b;
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        .video-iframe {
            width: 100%;
            height: 400px;
            border: none;
            border-radius: 10px;
            background: #000;
            object-fit: contain;
        }

        @media (max-width: 1400px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .video-section {
                order: -1;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>🎓 Trading Academy - Learn & Practice</h1>
            <p style="font-size: 1.2em; opacity: 0.9;">Watch videos to learn, then practice on the live chart!</p>
        </div>

        <div class="progress-indicator">
            <span class="progress-step completed">1</span>
            <span style="color: #96ceb4;">Watch</span>
            <span class="progress-step active">2</span>
            <span style="color: #96ceb4;">Practice</span>
            <span class="progress-step">3</span>
            <span style="color: #96ceb4;">Master</span>
        </div>

        <div class="main-layout">
            <div class="video-section">
                <h3>📹 Learn Trading Patterns</h3>

                <div class="video-container" onclick="openVideoModal()">
                    <div class="video-placeholder">
                        <div class="play-button"></div>
                    </div>
                </div>

                <div class="video-title" id="currentVideoTitle">Double Bottom Pattern Basics</div>
                <div class="video-description" id="currentVideoDescription">
                    Learn to identify the double bottom reversal pattern, one of the most reliable bullish patterns in
                    technical analysis. This video covers pattern recognition, volume confirmation, and entry/exit
                    strategies.
                </div>

                <div class="video-list" id="videoList">
                    <!-- Video items will be populated by JavaScript -->
                </div>
            </div>

            <div class="chart-section">
                <div class="chart-wrapper">
                    <canvas id="stockChart" width="900" height="500"></canvas>
                    <div id="tooltip" class="tooltip"></div>
                </div>
                <div class="trade-status" id="tradeStatus" style="display: none;">
                    <h4>Trade Status</h4>
                    <div class="pnl" id="pnlDisplay">₹0.00</div>
                    <div id="statusText">Position: Waiting for Entry</div>

                    <div class="trade-summary">
                        <div class="summary-row">
                            <span>Quantity:</span>
                            <span id="shareCount">0</span>
                        </div>
                        <div class="summary-row">
                            <span>Entry:</span>
                            <span id="entryDisplay">₹0.00</span>
                        </div>
                        <div class="summary-row">
                            <span>Current:</span>
                            <span id="currentPriceDisplay">₹0.00</span>
                        </div>
                        <div class="summary-row">
                            <span>Target:</span>
                            <span id="targetDisplay">₹0.00</span>
                        </div>
                        <div class="summary-row">
                            <span>Stop Loss:</span>
                            <span id="stopLossDisplay">₹0.00</span>
                        </div>
                        <div id="strategyFeedbackContainer" style="margin-top: 16px;">
                            <div id="strategyFeedback" style="
                              background: #1e2a3a;
                              border-left: 4px solid #4ecdc4;
                              padding: 12px 16px;
                              border-radius: 8px;
                              margin-top: 10px;
                              color: #ffffff;
                              font-size: 14px;
                              line-height: 1.6;
                            ">
                                <!-- Strategy feedback will go here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="trading-panel">
                <h3>🎯 Trading Setup</h3>

                <div class="current-price">
                    <div class="price" id="currentPrice">₹1204.65</div>
                    <div class="time" id="currentTime">12:00 PM - Ready to Trade</div>
                </div>

                <div class="input-group">
                    <label for="investment">Investment Amount (₹)</label>
                    <input type="number" id="investment" placeholder="Enter amount (e.g., 50000)" min="1" max="100000"
                        step="1000" value="100000">
                    <div id="investmentError" style="color: #ff6b6b; font-size: 13px; margin-top: 4px; display: none;">
                    </div>
                </div>

                <!-- BULLISH/BEARISH toggle -->
                <div class="input-group" id="tradeTypeGroup">
                    <label>Trade Direction</label>
                    <div style="display: flex; gap: 10px;">
                        <button type="button" id="bullishBtn" class="speed-btn active" onclick="setTradeType('bullish')"
                            style="color: #fff; background: #4ecdc4;">BULLISH</button>
                        <button type="button" id="bearishBtn" class="speed-btn" onclick="setTradeType('bearish')"
                            style="color: #fff; background: #ff6b6b;">BEARISH</button>
                    </div>
                </div>

                <div class="input-group">
                    <label for="entryPrice">Entry Price (₹)</label>
                    <input type="number" id="entryPrice" placeholder="Entry price" step="0.01" value="1240">
                    <div id="entryError" style="color: #ff6b6b; font-size: 13px; margin-top: 4px; display: none;"></div>
                </div>

                <div class="input-group">
                    <label for="targetPrice">Target Price (₹)</label>
                    <input type="number" id="targetPrice" placeholder="Target price" step="0.01" value="1278">
                    <div id="targetError" style="color: #ff6b6b; font-size: 13px; margin-top: 4px; display: none;">
                    </div>
                </div>

                <div class="input-group">
                    <label for="stopLoss">Stop Loss (₹)</label>
                    <input type="number" id="stopLoss" placeholder="Stop loss price" step="0.01" value="1200">
                    <div id="stopLossError" style="color: #ff6b6b; font-size: 13px; margin-top: 4px; display: none;">
                    </div>
                </div>

                <button class="invest-btn" id="investBtn" onclick="startTrade()">
                    🚀 INVEST & START SIMULATION
                </button>

                <div class="simulation-speed" id="speedControls" style="display: none;">
                    <div class="speed-btn active" onclick="setSpeed(500)">1x</div>
                    <div class="speed-btn" onclick="setSpeed(250)">2x</div>
                    <div class="speed-btn" onclick="setSpeed(100)">5x</div>
                    <div class="speed-btn" onclick="setSpeed(50)">10x</div>
                </div>
                <div class="pattern-info" id="patternInfo">
                    <h4>📈 Pattern Analysis</h4>
                    <div id="patternDetails">
                        <p><strong>Double Bottom Identified:</strong></p>
                        <p>• First Bottom: ₹1201.98 (10:30)</p>
                        <p>• Second Bottom: ₹1204.65 (11:45)</p>
                        <p>• Neckline: ₹1239.76</p>
                        <p>• Suggested Target: ₹1277.54</p>
                        <p style="color: #ffd93d; margin-top: 15px;"><strong>💡 Tip:</strong> Consider buying above
                            neckline break with volume confirmation!</p>
                    </div>
                </div>
                <!-- jhdbjkhabdkjbaskjbdkjasbdkjasbdkabk -->

                <div class="game-controls">
                    <button class="control-btn" onclick="resetGame()">🔄 Reset</button>
                    <button class="control-btn" onclick="pauseSimulation()" id="pauseBtn" style="display: none;">⏸️
                        Pause</button>
                </div>
            </div>
        </div>

        <div class="final-result" id="finalResult">
            <div class="result-title" id="resultTitle">Trade Complete!</div>
            <div class="result-pnl" id="resultPnL">₹0.00</div>
            <div id="resultDetails"></div>
            <button class="control-btn" onclick="closeResult()"
                style="margin-top: 20px; width: 200px;">Continue</button>
        </div>

        <div class="video-modal" id="videoModal">
            <div class="video-modal-content">
                <div class="video-modal-header">
                    <h3 id="modalVideoTitle">Video Title</h3>
                    <button class="close-modal" onclick="closeVideoModal()">✕ Close</button>
                </div>
                <div id="videoPlayer">
                    <div class="video-iframe"
                        style="display: flex; align-items: center; justify-content: center; color: #96ceb4;">
                        🎬 Video player will be embedded here
                        <br><br>
                        <small>In a real implementation, you would embed actual video content using:<br>
                            • YouTube iframe<br>
                            • Vimeo player<br>
                            • Custom video player<br>
                            • Educational platform integration</small>
                    </div>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                    <h4>Key Takeaways:</h4>
                    <div id="videoTakeaways">
                        <p>• Identify double bottom pattern formation</p>
                        <p>• Wait for neckline breakout with volume</p>
                        <p>• Set proper stop loss below second bottom</p>
                        <p>• Calculate target using pattern height</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Chart patterns data library
        const chartPatterns = {
            'double-bottom': {
                name: 'Double Bottom',
                data: [
                { "time": "9:15",  "open": 1266.95, "high": 1270.96, "low": 1257.42, "close": 1260.45, "volume": 54959 },
                { "time": "9:30",  "open": 1260.45, "high": 1268.46, "low": 1257.45, "close": 1264.2, "volume": 56188 },
                { "time": "9:45",  "open": 1264.2, "high": 1269.74, "low": 1254.25, "close": 1258.4, "volume": 57233 },
                { "time": "10:00", "open": 1258.4, "high": 1265.72, "low": 1248.95, "close": 1253.8, "volume": 59291 },
                { "time": "10:15", "open": 1253.8, "high": 1264.25, "low": 1235.81, "close": 1260.32, "volume": 104721 },
                { "time": "10:30", "open": 1260.32, "high": 1270.11, "low": 1258.94, "close": 1263.99, "volume": 61624 },
                { "time": "10:45", "open": 1263.99, "high": 1268.02, "low": 1254.54, "close": 1259.2, "volume": 42806 },
                { "time": "11:00", "open": 1259.2, "high": 1269.08, "low": 1257.1, "close": 1265.66, "volume": 45109 },
                { "time": "11:15", "open": 1265.66, "high": 1269.41, "low": 1258.31, "close": 1261.5, "volume": 55734 },
                { "time": "11:30", "open": 1261.5, "high": 1264.5, "low": 1253.0, "close": 1256.56, "volume": 58014 },
                { "time": "11:45", "open": 1256.56, "high": 1267.6, "low": 1230.85, "close": 1260.96, "volume": 97008 },
                { "time": "12:00", "open": 1260.96, "high": 1272.02, "low": 1259.81, "close": 1264.44, "volume": 115552 },
                { "time": "12:15", "open": 1264.44, "high": 1267.35, "low": 1256.39, "close": 1261.26, "volume": 138333 },
                { "time": "12:30", "open": 1261.26, "high": 1271.36, "low": 1257.03, "close": 1267.04, "volume": 39528 },
                { "time": "12:45", "open": 1267.04, "high": 1271.0, "low": 1258.73, "close": 1263.27, "volume": 75543 },
                { "time": "13:00", "open": 1263.27, "high": 1274.48, "low": 1260.22, "close": 1270.26, "volume": 54587 },
                { "time": "13:15", "open": 1270.26, "high": 1274.13, "low": 1262.09, "close": 1266.83, "volume": 39650 },
                { "time": "13:30", "open": 1266.83, "high": 1280.87, "low": 1265.35, "close": 1273.65, "volume": 51693 },
                { "time": "13:45", "open": 1273.65, "high": 1284.19, "low": 1270.8, "close": 1278.56, "volume": 97491 },
                { "time": "14:00", "open": 1278.56, "high": 1280.68, "low": 1270.08, "close": 1274.2, "volume": 84499 },
                { "time": "14:15", "open": 1274.2, "high": 1283.34, "low": 1271.35, "close": 1280.39, "volume": 60890 },
                { "time": "14:30", "open": 1280.39, "high": 1291.47, "low": 1277.63, "close": 1285.76, "volume": 62154 },
                { "time": "14:45", "open": 1285.76, "high": 1289.18, "low": 1277.04, "close": 1281.4, "volume": 67572 },
                { "time": "15:00", "open": 1281.4, "high": 1295.74, "low": 1278.97, "close": 1287.96, "volume": 78698 },
                { "time": "15:15", "open": 1287.96, "high": 1299.18, "low": 1283.92, "close": 1292.45, "volume": 46745 },
                { "time": "15:30", "open": 1292.45, "high": 1299.57, "low": 1286.48, "close": 1288.08, "volume": 68170 }
              ],
                minPrice: 1190,
                maxPrice: 1310,
                keyLevels: {
                    neckline: 1239.76,
                    target: 1277.54,
                    support1: 1201.98,
                    support2: 1204.65
                },
                defaultEntry: 1240,
                defaultTarget: 1278,
                defaultStop: 1200,
                startIndex: 11,
                patternInfo: {
                    title: "Double Bottom Pattern",
                    details: [
                        "• First Bottom: ₹1201.98 (10:30)",
                        "• Second Bottom: ₹1204.65 (11:45)",
                        "• Neckline: ₹1239.76",
                        "• Suggested Target: ₹1277.54"
                    ],
                    tip: "Consider buying above neckline break with volume confirmation!"
                }
            },
            'cup-handle': {
                name: 'Cup and Handle',
                data: [
                    {
                        "time": "9:15",
                        "open": 150.19,
                        "high": 151.64,
                        "low": 150.04,
                        "close": 151.61,
                        "volume": 42985
                    },
                    {
                        "time": "9:30",
                        "open": 151.61,
                        "high": 154.15,
                        "low": 151.78,
                        "close": 153.12,
                        "volume": 50443
                    },
                    {
                        "time": "9:45",
                        "open": 153.12,
                        "high": 154.44,
                        "low": 152.37,
                        "close": 153.69,
                        "volume": 31078
                    },
                    {
                        "time": "10:00",
                        "open": 153.69,
                        "high": 152.11,
                        "low": 150.13,
                        "close": 151.01,
                        "volume": 40837
                    },
                    {
                        "time": "10:15",
                        "open": 151.01,
                        "high": 151.56,
                        "low": 150.25,
                        "close": 151.03,
                        "volume": 30870
                    },
                    {
                        "time": "10:30",
                        "open": 151.03,
                        "high": 149.59,
                        "low": 147.73,
                        "close": 148.6,
                        "volume": 38112
                    },
                    {
                        "time": "10:45",
                        "open": 148.6,
                        "high": 148.89,
                        "low": 146.61,
                        "close": 148.4,
                        "volume": 30634
                    },
                    {
                        "time": "11:00",
                        "open": 148.4,
                        "high": 147.76,
                        "low": 146.78,
                        "close": 147.59,
                        "volume": 26646
                    },
                    {
                        "time": "11:15",
                        "open": 147.59,
                        "high": 149.82,
                        "low": 148.24,
                        "close": 149.03,
                        "volume": 30117
                    },
                    {
                        "time": "11:30",
                        "open": 149.03,
                        "high": 150.34,
                        "low": 148.73,
                        "close": 150.24,
                        "volume": 27835
                    },
                    {
                        "time": "11:45",
                        "open": 150.24,
                        "high": 152.46,
                        "low": 150.73,
                        "close": 151.75,
                        "volume": 24681
                    },
                    {
                        "time": "12:00",
                        "open": 151.75,
                        "high": 152.44,
                        "low": 151.62,
                        "close": 151.94,
                        "volume": 28689
                    },
                    {
                        "time": "12:15",
                        "open": 151.94,
                        "high": 151.81,
                        "low": 151.29,
                        "close": 151.33,
                        "volume": 13605
                    },
                    {
                        "time": "12:30",
                        "open": 151.33,
                        "high": 152.15,
                        "low": 150.89,
                        "close": 151.96,
                        "volume": 7459
                    },
                    {
                        "time": "12:45",
                        "open": 151.96,
                        "high": 151.2,
                        "low": 150.51,
                        "close": 150.59,
                        "volume": 9342
                    },
                    {
                        "time": "13:00",
                        "open": 150.59,
                        "high": 153.99,
                        "low": 151.34,
                        "close": 153.5,
                        "volume": 114637
                    },
                    {
                        "time": "13:15",
                        "open": 153.5,
                        "high": 155.37,
                        "low": 153.87,
                        "close": 153.95,
                        "volume": 91248
                    },
                    {
                        "time": "13:30",
                        "open": 153.95,
                        "high": 157.23,
                        "low": 155.52,
                        "close": 156.89,
                        "volume": 90388
                    },
                    {
                        "time": "13:45",
                        "open": 156.89,
                        "high": 157.45,
                        "low": 155.68,
                        "close": 156.08,
                        "volume": 40918
                    },
                    {
                        "time": "14:00",
                        "open": 156.08,
                        "high": 159.27,
                        "low": 157.42,
                        "close": 158.82,
                        "volume": 102614
                    },
                    {
                        "time": "14:15",
                        "open": 158.82,
                        "high": 158.97,
                        "low": 157.64,
                        "close": 157.91,
                        "volume": 82787
                    },
                    {
                        "time": "14:30",
                        "open": 157.91,
                        "high": 161.85,
                        "low": 159.39,
                        "close": 161.58,
                        "volume": 79798
                    },
                    {
                        "time": "14:45",
                        "open": 161.58,
                        "high": 161.46,
                        "low": 159.57,
                        "close": 160.13,
                        "volume": 69468
                    },
                    {
                        "time": "15:00",
                        "open": 160.13,
                        "high": 163,
                        "low": 161.52,
                        "close": 162.75,
                        "volume": 34991
                    },
                    {
                        "time": "15:15",
                        "open": 162.75,
                        "high": 164,
                        "low": 161.55,
                        "close": 161.77,
                        "volume": 60533
                    },
                    {
                        "time": "15:30",
                        "open": 161.77,
                        "high": 165.42,
                        "low": 163.83,
                        "close": 165.4,
                        "volume": 56977
                    }
                ],
                minPrice: 140,
                maxPrice: 170,
                keyLevels: {
                    rim: 154.0,
                    cupBottom: 147.2,
                    handleLow: 150.4,
                    breakout: 154.5
                },
                defaultEntry: 154.5,
                defaultTarget: 162.0,
                defaultStop: 150.0,
                startIndex: 14,
                patternInfo: {
                    title: "Cup and Handle Pattern",
                    details: [
                        "• Cup Formation: 9:45 - 11:15",
                        "• Handle Formation: 11:30 - 12:45",
                        "• Rim Level: ₹154.00",
                        "• Breakout Point: ₹154.50",
                        "• Target: ₹162.00 (Cup depth projection)"
                    ],
                    tip: "Wait for breakout above rim with strong volume for confirmation!"
                }
            },
            'rising-wedge': {
                name: 'Rising Wedge (Bearish)',
                data: [
                [
                  {
                    "time": "9:15",
                    "open": 185.77,
                    "high": 185.87,
                    "low": 184.05,
                    "close": 184.06,
                    "volume": 41036
                  },
                  {
                    "time": "9:30",
                    "open": 184.06,
                    "high": 186.7,
                    "low": 184.06,
                    "close": 184.29,
                    "volume": 38395
                  },
                  {
                    "time": "9:45",
                    "open": 184.29,
                    "high": 186.84,
                    "low": 184.29,
                    "close": 186.74,
                    "volume": 31656
                  },
                  {
                    "time": "10:00",
                    "open": 186.74,
                    "high": 187.6,
                    "low": 185.85,
                    "close": 186.17,
                    "volume": 27878
                  },
                  {
                    "time": "10:15",
                    "open": 186.17,
                    "high": 188.25,
                    "low": 186.01,
                    "close": 187.64,
                    "volume": 25659
                  },
                  {
                    "time": "10:30",
                    "open": 187.64,
                    "high": 188.62,
                    "low": 186.62,
                    "close": 186.62,
                    "volume": 19620
                  },
                  {
                    "time": "10:45",
                    "open": 186.62,
                    "high": 188.88,
                    "low": 186.62,
                    "close": 188.49,
                    "volume": 18522
                  },
                  {
                    "time": "11:00",
                    "open": 188.49,
                    "high": 189.39,
                    "low": 187.96,
                    "close": 187.96,
                    "volume": 15904
                  },
                  {
                    "time": "11:15",
                    "open": 187.96,
                    "high": 190.02,
                    "low": 187.96,
                    "close": 189.58,
                    "volume": 12814
                  },
                  {
                    "time": "11:30",
                    "open": 189.58,
                    "high": 190.2,
                    "low": 189.53,
                    "close": 189.55,
                    "volume": 9323
                  },
                  {
                    "time": "11:45",
                    "open": 189.55,
                    "high": 190.87,
                    "low": 189.55,
                    "close": 189.72,
                    "volume": 7262
                  },
                  {
                    "time": "12:00",
                    "open": 189.72,
                    "high": 191.43,
                    "low": 189.72,
                    "close": 191.13,
                    "volume": 6585
                  },
                  {
                    "time": "12:15",
                    "open": 191.13,
                    "high": 191.78,
                    "low": 190.72,
                    "close": 190.72,
                    "volume": 4035
                  },
                  {
                    "time": "12:30",
                    "open": 190.72,
                    "high": 191.68,
                    "low": 189.77,
                    "close": 189.77,
                    "volume": 101603
                  },
                  {
                    "time": "12:45",
                    "open": 189.77,
                    "high": 191.58,
                    "low": 189.77,
                    "close": 191.21,
                    "volume": 113005
                  },
                  {
                    "time": "13:00",
                    "open": 191.21,
                    "high": 191.48,
                    "low": 187.44,
                    "close": 187.44,
                    "volume": 122538
                  },
                  {
                    "time": "13:15",
                    "open": 187.44,
                    "high": 191.38,
                    "low": 187.44,
                    "close": 190.2,
                    "volume": 109413
                  },
                  {
                    "time": "13:30",
                    "open": 190.2,
                    "high": 191.28,
                    "low": 187.44,
                    "close": 187.44,
                    "volume": 110601
                  },
                  {
                    "time": "13:45",
                    "open": 187.44,
                    "high": 191.18,
                    "low": 186.34,
                    "close": 186.34,
                    "volume": 111645
                  },
                  {
                    "time": "14:00",
                    "open": 186.34,
                    "high": 191.08,
                    "low": 186.11,
                    "close": 186.11,
                    "volume": 88913
                  },
                  {
                    "time": "14:15",
                    "open": 186.11,
                    "high": 190.98,
                    "low": 185.45,
                    "close": 185.45,
                    "volume": 87723
                  },
                  {
                    "time": "14:30",
                    "open": 185.45,
                    "high": 190.88,
                    "low": 184.65,
                    "close": 184.65,
                    "volume": 80639
                  },
                  {
                    "time": "14:45",
                    "open": 184.65,
                    "high": 190.78,
                    "low": 183.93,
                    "close": 183.93,
                    "volume": 81835
                  },
                  {
                    "time": "15:00",
                    "open": 183.93,
                    "high": 190.68,
                    "low": 181.23,
                    "close": 181.23,
                    "volume": 75527
                  },
                  {
                    "time": "15:15",
                    "open": 181.23,
                    "high": 190.58,
                    "low": 181.23,
                    "close": 182.64,
                    "volume": 77915
                  },
                  {
                    "time": "15:30",
                    "open": 182.64,
                    "high": 190.48,
                    "low": 182.29,
                    "close": 182.29,
                    "volume": 59676
                  }
                ]
              ],
                minPrice: 175,
                maxPrice: 195,
                keyLevels: {
                    upperTrendline: 191.8,
                    lowerTrendline: 190.0,
                    breakdownLevel: 189.5,
                    target: 183.0
                },
                defaultEntry: 189.0,
                defaultTarget: 183.0,
                defaultStop: 192.0,
                startIndex: 12,
                patternInfo: {
                    title: "Rising Wedge Pattern (Bearish)",
                    details: [
                        "• Wedge Formation: 9:45 - 12:15",
                        "• Upper Trendline: ₹191.80",
                        "• Lower Trendline: ₹190.00",
                        "• Breakdown at: ₹189.50",
                        "• Target: ₹183.00 (Wedge height projection)"
                    ],
                    tip: "Short on breakdown below lower trendline with volume confirmation!"
                }
            },
            'marubozu': {
                name: 'Marubozu Candlestick',
                data: [
                [
                  {
                    "time": "9:15",
                    "open": 245.33,
                    "high": 246.88,
                    "low": 244.47,
                    "close": 246.8,
                    "volume": 141618
                  },
                  {
                    "time": "9:30",
                    "open": 246.8,
                    "high": 246.8,
                    "low": 243.8,
                    "close": 244.1,
                    "volume": 167860
                  },
                  {
                    "time": "9:45",
                    "open": 244.1,
                    "high": 245.24,
                    "low": 243.95,
                    "close": 245.22,
                    "volume": 163573
                  },
                  {
                    "time": "10:00",
                    "open": 245.22,
                    "high": 245.22,
                    "low": 244.01,
                    "close": 244.33,
                    "volume": 176008
                  },
                  {
                    "time": "10:15",
                    "open": 244.33,
                    "high": 244.88,
                    "low": 243.3,
                    "close": 244.78,
                    "volume": 254688
                  },
                  {
                    "time": "10:30",
                    "open": 244.78,
                    "high": 244.86,
                    "low": 242.45,
                    "close": 244.59,
                    "volume": 205654
                  },
                  {
                    "time": "10:45",
                    "open": 244.59,
                    "high": 244.59,
                    "low": 241.62,
                    "close": 242.05,
                    "volume": 177266
                  },
                  {
                    "time": "11:00",
                    "open": 242.05,
                    "high": 243,
                    "low": 241.31,
                    "close": 241.86,
                    "volume": 186673
                  },
                  {
                    "time": "11:15",
                    "open": 241.86,
                    "high": 243.87,
                    "low": 241.86,
                    "close": 243.66,
                    "volume": 141162
                  },
                  {
                    "time": "11:30",
                    "open": 241.88,
                    "high": 248.46,
                    "low": 241.88,
                    "close": 248.46,
                    "volume": 476140
                  },
                  {
                    "time": "11:45",
                    "open": 248.46,
                    "high": 249.89,
                    "low": 247.34,
                    "close": 249.23,
                    "volume": 317952
                  },
                  {
                    "time": "12:00",
                    "open": 249.23,
                    "high": 250.13,
                    "low": 248.24,
                    "close": 248.6,
                    "volume": 288148
                  },
                  {
                    "time": "12:15",
                    "open": 248.6,
                    "high": 253.19,
                    "low": 248.6,
                    "close": 252.16,
                    "volume": 230736
                  },
                  {
                    "time": "12:30",
                    "open": 252.16,
                    "high": 252.24,
                    "low": 249.91,
                    "close": 250.52,
                    "volume": 194805
                  },
                  {
                    "time": "12:45",
                    "open": 250.52,
                    "high": 254.67,
                    "low": 250.52,
                    "close": 254.14,
                    "volume": 178082
                  },
                  {
                    "time": "13:00",
                    "open": 254.14,
                    "high": 254.9,
                    "low": 251.01,
                    "close": 252.2,
                    "volume": 164281
                  },
                  {
                    "time": "13:15",
                    "open": 252.2,
                    "high": 256.68,
                    "low": 252.2,
                    "close": 255.15,
                    "volume": 128117
                  },
                  {
                    "time": "13:30",
                    "open": 255.15,
                    "high": 256,
                    "low": 251.55,
                    "close": 253.12,
                    "volume": 118397
                  },
                  {
                    "time": "13:45",
                    "open": 253.12,
                    "high": 255.83,
                    "low": 253.12,
                    "close": 254.73,
                    "volume": 111924
                  },
                  {
                    "time": "14:00",
                    "open": 254.73,
                    "high": 259.62,
                    "low": 254.73,
                    "close": 258.38,
                    "volume": 104822
                  },
                  {
                    "time": "14:15",
                    "open": 258.38,
                    "high": 258.38,
                    "low": 255.12,
                    "close": 255.9,
                    "volume": 101836
                  },
                  {
                    "time": "14:30",
                    "open": 255.9,
                    "high": 259.24,
                    "low": 255.9,
                    "close": 258.89,
                    "volume": 89967
                  },
                  {
                    "time": "14:45",
                    "open": 258.89,
                    "high": 260.6,
                    "low": 257.66,
                    "close": 258.73,
                    "volume": 78111
                  },
                  {
                    "time": "15:00",
                    "open": 258.73,
                    "high": 261.27,
                    "low": 258.31,
                    "close": 259.29,
                    "volume": 75375
                  },
                  {
                    "time": "15:15",
                    "open": 259.29,
                    "high": 263.02,
                    "low": 259.29,
                    "close": 262.62,
                    "volume": 65063
                  },
                  {
                    "time": "15:30",
                    "open": 262.62,
                    "high": 262.62,
                    "low": 260.32,
                    "close": 260.63,
                    "volume": 56940
                  }
                ]
              ],
                minPrice: 235,
                maxPrice: 270,
                keyLevels: {
                    marubozuOpen: 241.9,
                    marubozuClose: 248.45,
                    resistance: 250.0,
                    support: 240.0
                },
                defaultEntry: 249.0,
                defaultTarget: 255.0,
                defaultStop: 241.5,
                startIndex: 9,
                patternInfo: {
                    title: "Bullish Marubozu Pattern",
                    details: [
                        "• Marubozu Formation: 11:30",
                        "• Open: ₹241.90, Close: ₹248.45",
                        "• No Upper/Lower Shadows",
                        "• Strong Bullish Momentum",
                        "• Volume Spike: 485,000 shares"
                    ],
                    tip: "Strong bullish signal - consider buying on next candle confirmation!"
                }
            },
            'descending-triangle': {
                name: 'Descending Triangle',
                data: [
                {
                  "time": "9:15",
                  "open": 285.20,
                  "high": 286.50,
                  "low": 265.64,
                  "close": 284.60
                },
                {
                  "time": "9:30",
                  "open": 284.60,
                  "high": 285.74,
                  "low": 265.60,
                  "close": 283.20
                },
                {
                  "time": "9:45",
                  "open": 283.20,
                  "high": 284.97,
                  "low": 265.47,
                  "close": 283.70
                },
                {
                  "time": "10:00",
                  "open": 283.70,
                  "high": 284.21,
                  "low": 265.40,
                  "close": 281.20
                },
                {
                  "time": "10:15",
                  "open": 281.20,
                  "high": 283.44,
                  "low": 265.50,
                  "close": 280.50
                },
                {
                  "time": "10:30",
                  "open": 280.50,
                  "high": 282.68,
                  "low": 265.46,
                  "close": 281.00
                },
                {
                  "time": "10:45",
                  "open": 281.00,
                  "high": 281.92,
                  "low": 265.61,
                  "close": 281.30
                },
                {
                  "time": "11:00",
                  "open": 281.30,
                  "high": 281.15,
                  "low": 265.42,
                  "close": 280.20
                },
                {
                  "time": "11:15",
                  "open": 280.20,
                  "high": 280.39,
                  "low": 265.49,
                  "close": 280.39
                },
                {
                  "time": "11:30",
                  "open": 280.39,
                  "high": 279.62,
                  "low": 265.53,
                  "close": 279.62
                },
                {
                  "time": "11:45",
                  "open": 279.62,
                  "high": 278.86,
                  "low": 265.66,
                  "close": 278.86
                },
                {
                  "time": "12:00",
                  "open": 278.86,
                  "high": 278.10,
                  "low": 265.50,
                  "close": 278.10
                },
                {
                  "time": "12:15",
                  "open": 278.10,
                  "high": 277.33,
                  "low": 265.41,
                  "close": 277.33
                },
                {
                  "time": "12:30",
                  "open": 277.33,
                  "high": 276.57,
                  "low": 265.60,
                  "close": 276.57
                },
                {
                  "time": "12:45",
                  "open": 276.57,
                  "high": 275.80,
                  "low": 265.55,
                  "close": 275.80
                },
                {
                  "time": "13:00",
                  "open": 275.80,
                  "high": 275.04,
                  "low": 265.40,
                  "close": 275.04
                },
                {
                  "time": "13:15",
                  "open": 275.04,
                  "high": 274.28,
                  "low": 265.66,
                  "close": 274.28
                },
                {
                  "time": "13:30",
                  "open": 274.28,
                  "high": 273.51,
                  "low": 265.69,
                  "close": 273.50
                },
                {
                  "time": "13:45",
                  "open": 273.50,
                  "high": 272.75,
                  "low": 265.62,
                  "close": 272.75
                },
                {
                  "time": "14:00",
                  "open": 272.75,
                  "high": 271.98,
                  "low": 265.66,
                  "close": 271.10
                },
                {
                  "time": "14:15",
                  "open": 271.10,
                  "high": 271.22,
                  "low": 265.42,
                  "close": 270.20
                },
                {
                  "time": "14:30",
                  "open": 270.20,
                  "high": 270.46,
                  "low": 265.59,
                  "close": 270.46
                },
                {
                  "time": "14:45",
                  "open": 270.46,
                  "high": 269.69,
                  "low": 265.66,
                  "close": 268.50
                },
                {
                  "time": "15:00",
                  "open": 268.50,
                  "high": 268.93,
                  "low": 265.57,
                  "close": 267.60
                },
                {
                  "time": "15:15",
                  "open": 267.60,
                  "high": 268.16,
                  "low": 265.49,
                  "close": 268.10
                },
                {
                  "time": "15:30",
                  "open": 268.10,
                  "high": 267.40,
                  "low": 265.34,
                  "close": 266.10
                }
              ],
                minPrice: 260,
                maxPrice: 290,
                keyLevels: {
                    horizontalSupport: 279.8,
                    descendingResistance: 285.0,
                    breakdownLevel: 279.5,
                    target: 272.0
                },
                defaultEntry: 279.0,
                defaultTarget: 272.0,
                defaultStop: 281.5,
                startIndex: 12,
                patternInfo: {
                    title: "Descending Triangle Pattern",
                    details: [
                        "• Triangle Formation: 10:15 - 12:15",
                        "• Horizontal Support: ₹279.80",
                        "• Descending Resistance Line",
                        "• Breakdown at: ₹279.50",
                        "• Target: ₹272.00 (Triangle height projection)"
                    ],
                    tip: "Short on breakdown below support with increased volume!"
                }
            }
        };

        // Video library data with pattern associations
        const videoLibrary = [
            {
                id: 'double-bottom-basics',
                title: 'Double Bottom Pattern Strategy',
                duration: '8:45',
                description: 'Learn the double bottom pattern strategy and how to identify this powerful reversal pattern in the markets. This comprehensive tutorial covers entry points, stop losses, and profit targets.',
                videoUrl: 'https://storage.googleapis.com/ankdos/first_vid.mp4',
                patternType: 'double-bottom',
                takeaways: [
                    'Identify double bottom pattern formation',
                    'Wait for neckline breakout confirmation',
                    'Set proper stop loss below second bottom',
                    'Calculate target using pattern height measurement'
                ]
            },
            {
                id: 'cup-handle-pattern',
                title: 'Cup and Handle Trading Strategy',
                duration: '12:30',
                description: 'Master the cup and handle pattern - one of the most reliable bullish continuation patterns. Learn to identify the cup formation, handle consolidation, and optimal breakout entry points.',
                videoUrl: 'https://tmpfiles.org/dl/7082110/file_example_mp4_480_1_5mg.mp4',
                patternType: 'cup-handle',
                takeaways: [
                    'Recognize cup and handle formation',
                    'Identify proper cup depth and handle',
                    'Wait for volume confirmation on breakout',
                    'Calculate target using cup depth measurement'
                ]
            },
            {
                id: 'rising-wedge-pattern',
                title: 'Rising Wedge Bearish Pattern',
                duration: '10:20',
                description: 'Learn to identify and trade the rising wedge pattern - a bearish reversal pattern that often signals the end of uptrends. Covers pattern recognition and short selling strategies.',
                videoUrl: 'https://tmpfiles.org/dl/7082110/file_example_mp4_480_1_5mg.mp4',
                patternType: 'rising-wedge',
                takeaways: [
                    'Identify rising wedge characteristics',
                    'Recognize decreasing volume pattern',
                    'Time the breakdown for short entries',
                    'Set appropriate risk management levels'
                ]
            },
            {
                id: 'marubozu-candlestick',
                title: 'Marubozu Candlestick Power',
                duration: '7:15',
                description: 'Understanding the powerful Marubozu candlestick pattern that shows strong momentum. Learn to identify bullish and bearish Marubozu patterns and their trading implications.',
                videoUrl: 'https://tmpfiles.org/dl/7082110/file_example_mp4_480_1_5mg.mp4',
                patternType: 'marubozu',
                takeaways: [
                    'Identify Marubozu candlestick formation',
                    'Understand momentum significance',
                    'Trade continuation after Marubozu',
                    'Use volume confirmation for validation'
                ]
            },
            {
                id: 'descending-triangle',
                title: 'Descending Triangle Breakdown',
                duration: '11:45',
                description: 'Learn the descending triangle pattern - a bearish continuation pattern with horizontal support and descending resistance. Master the breakdown trading strategy.',
                videoUrl: 'https://tmpfiles.org/dl/7082110/file_example_mp4_480_1_5mg.mp4',
                patternType: 'descending-triangle',
                takeaways: [
                    'Identify descending triangle structure',
                    'Wait for support breakdown',
                    'Use volume confirmation for entries',
                    'Calculate measured move targets'
                ]
            },
            {
                id: 'intraday-patterns',
                title: '5-Minute Chart Patterns',
                duration: '9:30',
                description: 'Master intraday trading with 5-minute chart patterns. Learn to identify and trade quick patterns for day trading success with proper risk management.',
                videoUrl: 'https://tmpfiles.org/dl/7082110/file_example_mp4_480_1_5mg.mp4',
                patternType: 'five-min-double-bottom',
                takeaways: [
                    'Identify intraday pattern formations',
                    'Use tight stop losses for day trading',
                    'Quick entry and exit strategies',
                    'Manage risk in fast-moving markets'
                ]
            }
        ];

        let currentVideoIndex = 0;
        let currentPattern = chartPatterns['double-bottom'];
        let stockData = currentPattern.data;

        // Game state
        let gameState = {
            currentCandleIndex: currentPattern.startIndex,
            investment: 0,
            entryPrice: 0,
            targetPrice: 0,
            stopLoss: 0,
            shares: 0,
            isTrading: false,
            isPositionOpen: false,
            finalPnL: 0,
            simulationSpeed: 500,
            isPaused: false,
            tradeExecuted: false,
            exitReason: '',
            intervalId: null,
            tradeEndIndex: -1
        };

        // Chart setup
        const canvas = document.getElementById('stockChart');
        const ctx = canvas.getContext('2d');
        const tooltip = document.getElementById('tooltip');

        // Chart dimensions and padding
        const padding = { top: 40, right: 80, bottom: 60, left: 80 };
        const chartWidth = canvas.width - padding.left - padding.right;
        const chartHeight = canvas.height - padding.top - padding.bottom;

        // Video functions
        function populateVideoList() {
            const videoList = document.getElementById('videoList');
            videoList.innerHTML = '';

            videoLibrary.forEach((video, index) => {
                const videoItem = document.createElement('div');
                videoItem.className = `video-item ${index === currentVideoIndex ? 'active' : ''}`;
                videoItem.onclick = () => selectVideo(index);

                videoItem.innerHTML = `
                    <div class="video-item-title">${video.title}</div>
                    <div class="video-item-duration">${video.duration}</div>
                    <div class="pattern-badge">${chartPatterns[video.patternType].name}</div>
                `;

                videoList.appendChild(videoItem);
            });
        }

        function selectVideo(index) {
            currentVideoIndex = index;
            const video = videoLibrary[index];

            // Switch to the pattern associated with this video
            currentPattern = chartPatterns[video.patternType];
            stockData = currentPattern.data;

            // Update UI
            document.getElementById('currentVideoTitle').textContent = video.title;
            document.getElementById('currentVideoDescription').textContent = video.description;

            // Update pattern info
            updatePatternInfo();

            // Reset default values for this pattern
            updateDefaultValues();

            // Update active video in list
            document.querySelectorAll('.video-item').forEach((item, i) => {
                item.classList.toggle('active', i === index);
            });

            // Reset and redraw chart
            resetGame();
        }

        function updatePatternInfo() {
            const patternDetails = document.getElementById('patternDetails');
            const info = currentPattern.patternInfo;

            let detailsHTML = `<p><strong>${info.title}:</strong></p>`;
            info.details.forEach(detail => {
                detailsHTML += `<p>${detail}</p>`;
            });
            detailsHTML += `<p style="color: #ffd93d; margin-top: 15px;"><strong>💡 Tip:</strong> ${info.tip}</p>`;

            patternDetails.innerHTML = detailsHTML;
        }

        function updateDefaultValues() {
            document.getElementById('entryPrice').value = currentPattern.defaultEntry;
            document.getElementById('targetPrice').value = currentPattern.defaultTarget;
            document.getElementById('stopLoss').value = currentPattern.defaultStop;
            tradeType = 'bullish';
            setTradeType('bullish');
            // Update current price display
            const startCandle = stockData[currentPattern.startIndex];
            document.getElementById('currentPrice').textContent = `₹${startCandle.close.toFixed(2)}`;
            document.getElementById('currentTime').textContent = `${startCandle.time} - Ready to Trade`;
        }

        function openVideoModal() {
            const video = videoLibrary[currentVideoIndex];
            const modal = document.getElementById('videoModal');

            document.getElementById('modalVideoTitle').textContent = video.title;

            // Embed HTML5 video player
            document.getElementById('videoPlayer').innerHTML = `
                <video 
                    class="video-iframe" 
                    controls 
                    preload="metadata"
                    style="width: 100%; height: 400px; border-radius: 10px; background: #000;">
                    <source src="${video.videoUrl}" type="video/mp4">
                    <p style="color: #ff6b6b; text-align: center; padding: 20px;">
                        Your browser doesn't support HTML5 video. 
                        <a href="${video.videoUrl}" style="color: #4ecdc4;">Download the video</a> instead.
                    </p>
                </video>
            `;

            // Update takeaways
            const takeawaysHtml = video.takeaways.map(takeaway => `<p>• ${takeaway}</p>`).join('');
            document.getElementById('videoTakeaways').innerHTML = takeawaysHtml;

            modal.style.display = 'flex';
        }

        function closeVideoModal() {
            const modal = document.getElementById('videoModal');
            modal.style.display = 'none';

            // Stop the video
            const videoElement = document.querySelector('#videoPlayer video');
            if (videoElement) {
                videoElement.pause();
                videoElement.currentTime = 0;
            }

            setTimeout(() => {
                document.getElementById('videoPlayer').innerHTML = '';
            }, 100);
        }

        // Utility functions
        function priceToY(price) {
            return padding.top + (currentPattern.maxPrice - price) / (currentPattern.maxPrice - currentPattern.minPrice) * chartHeight;
        }

        function indexToX(index) {
            return padding.left + (index / (stockData.length - 1)) * chartWidth;
        }

        function drawCandlestick(ctx, x, data, width = 8) {
            const openY = priceToY(data.open);
            const closeY = priceToY(data.close);
            const highY = priceToY(data.high);
            const lowY = priceToY(data.low);

            const isBullish = data.close >= data.open;
            const bodyTop = Math.min(openY, closeY);
            const bodyBottom = Math.max(openY, closeY);
            const bodyHeight = Math.abs(closeY - openY);

            // Draw wick
            ctx.strokeStyle = isBullish ? '#4ecdc4' : '#ff6b6b';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(x, highY);
            ctx.lineTo(x, lowY);
            ctx.stroke();

            // Draw body
            ctx.fillStyle = isBullish ? '#4ecdc4' : '#ff6b6b';
            if (bodyHeight < 3) {
                // Doji - draw a line
                ctx.strokeStyle = isBullish ? '#4ecdc4' : '#ff6b6b';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(x - width / 2, openY);
                ctx.lineTo(x + width / 2, openY);
                ctx.stroke();
            } else {
                ctx.fillRect(x - width / 2, bodyTop, width, bodyHeight);
            }
        }

        function drawGrid() {
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;

            // Horizontal grid lines
            const priceRange = currentPattern.maxPrice - currentPattern.minPrice;
            const priceStep = priceRange > 100 ? 20 : priceRange > 50 ? 10 : 5;

            for (let price = Math.ceil(currentPattern.minPrice / priceStep) * priceStep; price <= currentPattern.maxPrice; price += priceStep) {
                const y = priceToY(price);
                ctx.beginPath();
                ctx.moveTo(padding.left, y);
                ctx.lineTo(padding.left + chartWidth, y);
                ctx.stroke();

                // Price labels
                ctx.fillStyle = '#ffffff';
                ctx.font = '11px Arial';
                ctx.textAlign = 'right';
                ctx.fillText('₹' + price, padding.left - 10, y + 4);
            }

            // Vertical grid lines
            const timeStep = Math.max(1, Math.floor(stockData.length / 8));
            for (let i = 0; i < stockData.length; i += timeStep) {
                const x = indexToX(i);
                ctx.beginPath();
                ctx.moveTo(x, padding.top);
                ctx.lineTo(x, padding.top + chartHeight);
                ctx.stroke();

                // Time labels
                ctx.fillStyle = '#ffffff';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(stockData[i].time, x, padding.top + chartHeight + 20);
            }
        }

        function drawKeyLevels() {
            const levels = currentPattern.keyLevels;

            // Draw pattern-specific key levels
            Object.keys(levels).forEach((levelName, index) => {
                const level = levels[levelName];
                const colors = ['#ffd93d', '#ff9ff3', '#96ceb4', '#4ecdc4', '#ff6b6b'];
                const color = colors[index % colors.length];

                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.setLineDash([8, 4]);
                const levelY = priceToY(level);
                ctx.beginPath();
                ctx.moveTo(padding.left, levelY);
                ctx.lineTo(padding.left + chartWidth, levelY);
                ctx.stroke();

                // Level label
                ctx.fillStyle = color;
                ctx.font = '10px Arial';
                ctx.textAlign = 'left';
                ctx.fillText(levelName, padding.left + 5, levelY - 5);
            });

            ctx.setLineDash([]);

            // Draw trade levels if position is open
            if (gameState.isPositionOpen) {
                // Entry price
                ctx.strokeStyle = '#96ceb4';
                ctx.lineWidth = 2;
                ctx.setLineDash([2, 2]);
                const entryY = priceToY(gameState.entryPrice);
                ctx.beginPath();
                ctx.moveTo(padding.left, entryY);
                ctx.lineTo(padding.left + chartWidth, entryY);
                ctx.stroke();

                // Target price
                ctx.strokeStyle = '#4ecdc4';
                const targetY = priceToY(gameState.targetPrice);
                ctx.beginPath();
                ctx.moveTo(padding.left, targetY);
                ctx.lineTo(padding.left + chartWidth, targetY);
                ctx.stroke();

                // Stop loss
                ctx.strokeStyle = '#ff6b6b';
                const stopY = priceToY(gameState.stopLoss);
                ctx.beginPath();
                ctx.moveTo(padding.left, stopY);
                ctx.lineTo(padding.left + chartWidth, stopY);
                ctx.stroke();

                ctx.setLineDash([]);
            }
        }

        function drawChart() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw grid
            drawGrid();

            // Draw key levels
            drawKeyLevels();

            // Draw candlesticks up to current index
            for (let i = 0; i <= gameState.currentCandleIndex; i++) {
                const data = stockData[i];
                const x = indexToX(i);
                drawCandlestick(ctx, x, data);
            }

            // Highlight current candle if trading
            if (gameState.isTrading && gameState.currentCandleIndex < stockData.length - 1) {
                const currentX = indexToX(gameState.currentCandleIndex);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
                ctx.fillRect(currentX - 10, padding.top, 20, chartHeight);
            }

            // Draw title
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`${currentPattern.name} - Trading Simulation`, canvas.width / 2, 25);
        }

        // Error display helpers
        function showError(id, msg) {
            const el = document.getElementById(id);
            el.textContent = msg;
            el.style.display = msg ? 'block' : 'none';
        }

        function validateForm() {
            const investBtn = document.getElementById('investBtn');
            const hasError =
                document.getElementById('investmentError').textContent.trim().length > 0 ||
                document.getElementById('entryError').textContent.trim().length > 0 ||
                document.getElementById('targetError').textContent.trim().length > 0 ||
                document.getElementById('stopLossError').textContent.trim().length > 0;
            investBtn.disabled = hasError ? true : false;
        }

        // Make sure to call validateForm() after every relevant input change
        document.getElementById('investment').addEventListener('input', function () {
            let val = parseInt(this.value);
            if (val > 100000) {
                showError('investmentError', 'Maximum allowed amount is ₹1,00,000');
            } else if (val < 1) {
                showError('investmentError', 'Minimum allowed amount is ₹1');
            } else {
                showError('investmentError', '');
            }
            validateForm();
        });

        document.getElementById('entryPrice').addEventListener('input', function () {
            const entry = parseFloat(this.value);
            const startCandle = stockData[currentPattern.startIndex];
            if (tradeType === 'bullish' && entry <= startCandle.close) {
                showError('entryError', 'Entry price must be greater than current price for Buy.');
            } else if (tradeType === 'bearish' && entry >= startCandle.close) {
                showError('entryError', 'Entry price must be less than current price for Sell.');
            } else {
                showError('entryError', '');
            }
            validateForm();
        });

        document.getElementById('targetPrice').addEventListener('input', function () {
            const target = parseFloat(this.value);
            const entry = parseFloat(document.getElementById('entryPrice').value);
            if (isNaN(entry)) {
                showError('targetError', '');
                validateForm();
                return;
            }
            if (tradeType === 'bullish' && target <= entry) {
                showError('targetError', 'Target price must be greater than Entry price for Buy.');
            } else if (tradeType === 'bearish' && target >= entry) {
                showError('targetError', 'Target price must be less than Entry price for Sell.');
            } else {
                showError('targetError', '');
            }
            validateForm();
        });

        document.getElementById('stopLoss').addEventListener('input', function () {
            const stop = parseFloat(this.value);
            const entry = parseFloat(document.getElementById('entryPrice').value);
            if (isNaN(entry)) {
                showError('stopLossError', '');
                validateForm();
                return;
            }
            if (tradeType === 'bullish' && stop >= entry) {
                showError('stopLossError', 'Stop loss must be less than Entry price for Buy.');
            } else if (tradeType === 'bearish' && stop <= entry) {
                showError('stopLossError', 'Stop loss must be greater than Entry price for Sell.');
            } else {
                showError('stopLossError', '');
            }
            validateForm();
        });

        // Also validate on trade type change
        function setTradeType(type) {
            tradeType = type;
            document.getElementById('bullishBtn').classList.toggle('active', type === 'bullish');
            document.getElementById('bearishBtn').classList.toggle('active', type === 'bearish');
            // Change color for bearish
            if (type === 'bearish') {
                document.getElementById('bearishBtn').style.background = '#ff6b6b';
                document.getElementById('bearishBtn').style.color = '#fff';
                document.getElementById('bullishBtn').style.background = '';
                document.getElementById('bullishBtn').style.color = '';
            } else {
                document.getElementById('bullishBtn').style.background = '#4ecdc4';
                document.getElementById('bullishBtn').style.color = '#fff';
                document.getElementById('bearishBtn').style.background = '';
                document.getElementById('bearishBtn').style.color = '';
            }
            // Re-validate entry, target, and stop loss
            document.getElementById('entryPrice').dispatchEvent(new Event('input'));
            document.getElementById('targetPrice').dispatchEvent(new Event('input'));
            document.getElementById('stopLoss').dispatchEvent(new Event('input'));
            validateForm();
        }
        // Validate and start trade
        function startTrade() {
            let hasError = false;
            const investment = parseFloat(document.getElementById('investment').value);
            const entryPrice = parseFloat(document.getElementById('entryPrice').value);
            const targetPrice = parseFloat(document.getElementById('targetPrice').value);
            const stopLoss = parseFloat(document.getElementById('stopLoss').value);
            const startCandle = stockData[currentPattern.startIndex];

            // Set up trade
            gameState.investment = investment;
            gameState.entryPrice = entryPrice;
            gameState.targetPrice = targetPrice;
            gameState.stopLoss = stopLoss;
            gameState.shares = Math.floor(investment / entryPrice);
            gameState.isTrading = true;
            gameState.isPositionOpen = false;
            gameState.tradeExecuted = false;
            gameState.currentCandleIndex = currentPattern.startIndex;

            // Update UI
            document.getElementById('investBtn').disabled = true;
            document.getElementById('tradeStatus').style.display = 'block';
            document.getElementById('speedControls').style.display = 'flex';
            document.getElementById('pauseBtn').style.display = 'block';

            updateTradeDisplay();

            // Start simulation
            startSimulation();
        }

        function startSimulation() {
            document.getElementById("strategyFeedback").innerHTML = "";
            if (gameState.intervalId) {
                clearInterval(gameState.intervalId);
            }

            gameState.intervalId = setInterval(() => {
                if (gameState.isPaused) return;

                gameState.currentCandleIndex++;

                if (gameState.currentCandleIndex >= stockData.length) {
                    endSimulation();
                    return;
                }

                const currentCandle = stockData[gameState.currentCandleIndex];
                updateCurrentPrice(currentCandle.close, currentCandle.time);

                // Check for trade execution
                const isBearishPattern = currentPattern.name.includes('Wedge') || currentPattern.name.includes('Triangle');

                if (!gameState.tradeExecuted) {
                    let shouldExecute = false;
                    if (tradeType === 'bearish') {
                        // Bearish: execute when price drops to entry level (like Rising Wedge Bearish)
                        shouldExecute = currentCandle.low <= gameState.entryPrice;
                    } else {
                        // Bullish: execute when price rises to entry level
                        shouldExecute = currentCandle.high >= gameState.entryPrice;
                    }
                    if (shouldExecute) {
                        executeEntry(currentCandle);
                    }
                }

                // Check for exit conditions if position is open
                if (gameState.isPositionOpen) {
                    checkExitConditions(currentCandle);
                }

                drawChart();
                updateTradeDisplay();

            }, gameState.simulationSpeed);
        }

        function executeEntry(candle) {
            gameState.tradeExecuted = true;
            gameState.isPositionOpen = true;

            // Use the exact entry price or adjust based on gap
            const isBearishPattern = currentPattern.name.includes('Wedge') || currentPattern.name.includes('Triangle');
            let actualEntry;
            if (tradeType === 'bearish') {
                actualEntry = Math.min(gameState.entryPrice, candle.open);
            } else {
                actualEntry = Math.max(gameState.entryPrice, candle.open);
            }
            gameState.shares = Math.floor(gameState.investment / actualEntry);
            gameState.entryPrice = actualEntry;
            updateTradeDisplay();
        }

        function checkExitConditions(candle) {
            let exitPrice = 0;
            let reason = '';

            const isBearishPattern = currentPattern.name.includes('Wedge') || currentPattern.name.includes('Triangle');

            if (isBearishPattern) {
                // For short positions
                // Check stop loss (price goes up)
                if (candle.high >= gameState.stopLoss) {
                    exitPrice = gameState.stopLoss;
                    reason = 'Stop Loss Hit';
                }
                // Check target (price goes down)
                else if (candle.low <= gameState.targetPrice) {
                    exitPrice = gameState.targetPrice;
                    reason = 'Target Achieved';
                }
            } else {
                // For long positions
                // Check stop loss (price goes down)
                if (candle.low <= gameState.stopLoss) {
                    exitPrice = gameState.stopLoss;
                    reason = 'Stop Loss Hit';
                }
                // Check target (price goes up)
                else if (candle.high >= gameState.targetPrice) {
                    exitPrice = gameState.targetPrice;
                    reason = 'Target Achieved';
                }
            }

            if (exitPrice > 0) {
                executeExit(exitPrice, reason);
            }
        }

        function executeExit(exitPrice, reason) {
            gameState.isPositionOpen = false;

            const isBearishPattern = currentPattern.name.includes('Wedge') || currentPattern.name.includes('Triangle');

            if (isBearishPattern) {
                // For short positions, profit when price goes down
                gameState.finalPnL = (gameState.entryPrice - exitPrice) * gameState.shares;
            } else {
                // For long positions, profit when price goes up
                gameState.finalPnL = (exitPrice - gameState.entryPrice) * gameState.shares;
            }
            gameState.exitReason = reason;
            gameState.tradeEndIndex = gameState.currentCandleIndex;
            updateTradeDisplay();
        }

        function endSimulation() {
            if (gameState.intervalId) {
                clearInterval(gameState.intervalId);
                gameState.intervalId = null;
            }

            // If position is still open, close at current price
            if (gameState.isPositionOpen) {
                const currentCandle = stockData[stockData.length - 1];
                const isBearishPattern = currentPattern.name.includes('Wedge') || currentPattern.name.includes('Triangle');

                if (isBearishPattern) {
                    gameState.finalPnL = (gameState.entryPrice - currentCandle.close) * gameState.shares;
                } else {
                    gameState.finalPnL = (currentCandle.close - gameState.entryPrice) * gameState.shares;
                }

                gameState.exitReason = 'Market Close';
                gameState.isPositionOpen = false;
            }

            gameState.isTrading = false;
            showFinalResult();
            showStrategyFeedback(gameState.finalPnL);
        }

        function updateCurrentPrice(price, time) {
            document.getElementById('currentPrice').textContent = `₹${price.toFixed(2)}`;
            document.getElementById('currentTime').textContent = `${time} - Live Trading`;
        }

        function updateTradeDisplay() {
            const currentPrice = stockData[gameState.currentCandleIndex].close;

            document.getElementById('shareCount').textContent = gameState.shares;
            document.getElementById('entryDisplay').textContent = `₹${gameState.entryPrice.toFixed(2)}`;
            document.getElementById('currentPriceDisplay').textContent = `₹${currentPrice.toFixed(2)}`;
            document.getElementById('targetDisplay').textContent = `₹${gameState.targetPrice.toFixed(2)}`;
            document.getElementById('stopLossDisplay').textContent = `₹${gameState.stopLoss.toFixed(2)}`;

            // Calculate current P&L
            let currentPnL = 0;
            let statusText = 'Position: Waiting for Entry';

            if (gameState.tradeExecuted && gameState.isPositionOpen) {
                const isBearishPattern = currentPattern.name.includes('Wedge') || currentPattern.name.includes('Triangle');

                if (isBearishPattern) {
                    // Short position P&L
                    currentPnL = (gameState.entryPrice - currentPrice) * gameState.shares;
                } else {
                    // Long position P&L
                    currentPnL = (currentPrice - gameState.entryPrice) * gameState.shares;
                }

                statusText = `Position: Open (${isBearishPattern ? 'Short' : 'Long'})`;
            } else if (gameState.tradeExecuted && !gameState.isPositionOpen) {
                currentPnL = gameState.finalPnL;
                statusText = `Position: Closed (${gameState.exitReason})`;
            }

            // Update P&L display
            const pnlElement = document.getElementById('pnlDisplay');
            pnlElement.textContent = `₹${currentPnL.toFixed(2)}`;

            if (currentPnL > 0) {
                pnlElement.className = 'pnl profit';
            } else if (currentPnL < 0) {
                pnlElement.className = 'pnl loss';
            } else {
                pnlElement.className = 'pnl neutral';
            }

            document.getElementById('statusText').textContent = statusText;
        }

        function showFinalResult() {
            const resultTitle = document.getElementById('resultTitle');
            const resultPnL = document.getElementById('resultPnL');
            const resultDetails = document.getElementById('resultDetails');

            const pnl = gameState.finalPnL;
            const percentage = ((pnl / gameState.investment) * 100).toFixed(2);

            let detailsHTML = `<p><strong>Pattern:</strong> ${currentPattern.name}</p>`;

            if (pnl > 0) {
                resultTitle.textContent = '🎉 Profitable Trade!';
                resultTitle.style.color = '#4ecdc4';
                resultPnL.textContent = `+₹${pnl.toFixed(2)}`;
                resultPnL.className = 'result-pnl profit';

                const exitPrice = gameState.entryPrice + (pnl / gameState.shares);
                detailsHTML += `
            <p><strong>Return:</strong> ${percentage}%</p>
            <p><strong>Exit Reason:</strong> ${gameState.exitReason}</p>
            <p><strong>Shares Traded:</strong> ${gameState.shares}</p>
            <p><strong>Entry Price:</strong> ₹${gameState.entryPrice.toFixed(2)}</p>
            <p><strong>Exit Price:</strong> ₹${exitPrice.toFixed(2)}</p>
        `;
            } else if (pnl < 0) {
                resultTitle.textContent = '📉 Loss Incurred';
                resultTitle.style.color = '#ff6b6b';
                resultPnL.textContent = `-₹${Math.abs(pnl).toFixed(2)}`;
                resultPnL.className = 'result-pnl loss';

                const exitPrice = gameState.entryPrice - (Math.abs(pnl) / gameState.shares);
                detailsHTML += `
            <p><strong>Return:</strong> ${percentage}%</p>
            <p><strong>Exit Reason:</strong> ${gameState.exitReason}</p>
            <p><strong>Shares Traded:</strong> ${gameState.shares}</p>
            <p><strong>Entry Price:</strong> ₹${gameState.entryPrice.toFixed(2)}</p>
            <p><strong>Exit Price:</strong> ₹${exitPrice.toFixed(2)}</p>
        `;
            } else {
                resultTitle.textContent = '➖ Break Even';
                resultTitle.style.color = '#ffd93d';
                resultPnL.textContent = '₹0.00';
                resultPnL.className = 'result-pnl neutral';

                detailsHTML += `
            <p><strong>Return:</strong> 0.00%</p>
            <p><strong>Exit Reason:</strong> NA</p>
        `;
            }

            resultDetails.innerHTML = detailsHTML;
            document.getElementById('finalResult').style.display = 'block';
        }
        function showStrategyFeedback(pnl) {
            const feedbackMap = {
                'Double Bottom': (pnl) => {
                    if (pnl > 0) return `🟢 <strong>Good Job:</strong> Entered near the second bottom and exited on breakout.<br>📈 <strong>Right:</strong> Timing and breakout confirmation.<br>💡 <strong>Tip:</strong> Use volume for validation.`;
                    if (pnl < 0) return `🔴 <strong>Oops:</strong> Entered too early or false breakout.<br>⚠️ <strong>Wrong:</strong> No confirmation.<br>💡 <strong>Tip:</strong> Wait for volume breakout.`;
                    return `⚖️ <strong>Break Even:</strong> Setup lacked momentum.<br>🧭 <strong>Tip:</strong> Manage trades better.`;
                },
                'Cup and Handle': (pnl) => {
                    if (pnl > 0) return `🟢 <strong>Nice Entry:</strong> Post-handle breakout captured.<br>✅ <strong>Worked:</strong> Clear breakout.<br>💡 <strong>Tip:</strong> Use trailing stop for more upside.`;
                    if (pnl < 0) return `🔴 <strong>Entry Error:</strong> Too early or no volume.<br>❌ <strong>Issue:</strong> Entered before confirmation.<br>💡 <strong>Tip:</strong> Wait for full handle.`;
                    return `⚖️ <strong>Flat:</strong> No follow-through.<br>💡 <strong>Tip:</strong> Be patient.`;
                },
                'Rising Wedge Bearish': (pnl) => {
                    if (pnl > 0) return `⚠️ <strong>Lucky Long:</strong> Profited despite bearish setup.<br>🚫 <strong>Warning:</strong> Against trend.<br>💡 <strong>Tip:</strong> Consider shorts after breakdown.`;
                    if (pnl < 0) return `🟢 <strong>Great Short:</strong> Breakdown worked.<br>✅ <strong>Right Call:</strong> Trend confirmed.<br>💡 <strong>Tip:</strong> Use volume confirmation.`;
                    return `⚖️ <strong>No Follow-through:</strong> Price hovered.`;
                },
                'Marubozu': (pnl) => {
                    if (pnl > 0) return `🚀 <strong>Momentum Win:</strong> You caught it well!<br>🟢 <strong>Right:</strong> Confirmation and entry.<br>💡 <strong>Tip:</strong> Trail stop smartly.`;
                    if (pnl < 0) return `🔴 <strong>Weak Move:</strong> No follow-up on Marubozu.<br>❌ <strong>Issue:</strong> Poor candle strength.<br>💡 <strong>Tip:</strong> Watch for volume.`;
                    return `⚖️ <strong>Flat:</strong> No real move.`;
                },
                'Descending Triangle': (pnl) => {
                    if (pnl > 0) return `⚠️ <strong>Atypical Win:</strong> Went against pattern and worked.<br>🚫 <strong>Note:</strong> Risky.<br>💡 <strong>Tip:</strong> Prefer breakout alignment.`;
                    if (pnl < 0) return `🟢 <strong>Well Timed:</strong> Shorted after breakdown.<br>✅ <strong>Effective:</strong> Classic strategy success.<br>💡 <strong>Tip:</strong> Watch for retest.`;
                    return `⚖️ <strong>Stalled:</strong> No clear direction.`;
                },
                '5-Minute Chart': (pnl) => {
                    if (pnl > 0) return `🧠 <strong>Quick Gain:</strong> Great scalp!<br>✅ <strong>Good Entry:</strong> Took opportunity.<br>💡 <strong>Tip:</strong> Always pre-define exit.`;
                    if (pnl < 0) return `❌ <strong>Noisy Trade:</strong> Caught in chop.<br>🛑 <strong>Issue:</strong> Lack of signal.<br>💡 <strong>Tip:</strong> Wait for confirmation.`;
                    return `⚖️ <strong>Flat:</strong> Watch for clearer entry next time.`;
                }
            };

            let pattern = currentPattern?.name || 'Unknown';
            if (pattern.includes('Double Bottom')) pattern = 'Double Bottom';
            if (pattern.includes('Cup and Handle')) pattern = 'Cup and Handle';
            if (pattern.includes('Rising Wedge')) pattern = 'Rising Wedge Bearish';
            if (pattern.includes('Marubozu')) pattern = 'Marubozu';
            if (pattern.includes('Descending Triangle')) pattern = 'Descending Triangle';
            if (pattern.includes('5-Minute')) pattern = '5-Minute Chart';

            const feedbackFn = feedbackMap[pattern];
            const strategyFeedbackEl = document.getElementById('strategyFeedback');

            strategyFeedbackEl.innerHTML = feedbackFn
                ? `<strong style="color:#4ecdc4; font-size: 16px;">📋 Trade Feedback:</strong><br>${feedbackFn(pnl)}`
                : `<strong>📋 Feedback:</strong> No specific feedback available.`;

        }


        function closeResult() {
            document.getElementById('finalResult').style.display = 'none';
        }

        function resetGame() {
            // Clear any running simulation
            if (gameState.intervalId) {
                clearInterval(gameState.intervalId);
                gameState.intervalId = null;
            }

            // Reset game state
            gameState = {
                currentCandleIndex: currentPattern.startIndex,
                investment: 0,
                entryPrice: 0,
                targetPrice: 0,
                stopLoss: 0,
                shares: 0,
                isTrading: false,
                isPositionOpen: false,
                finalPnL: 0,
                simulationSpeed: 500,
                isPaused: false,
                tradeExecuted: false,
                exitReason: '',
                intervalId: null,
                tradeEndIndex: -1
            };

            // Reset UI
            document.getElementById('investBtn').disabled = false;
            document.getElementById('tradeStatus').style.display = 'none';
            document.getElementById('speedControls').style.display = 'none';
            document.getElementById('pauseBtn').style.display = 'none';
            document.getElementById('finalResult').style.display = 'none';

            // Update current price display
            const startCandle = stockData[currentPattern.startIndex];
            document.getElementById('currentPrice').textContent = `₹${startCandle.close.toFixed(2)}`;
            document.getElementById('currentTime').textContent = `${startCandle.time} - Ready to Trade`;

            // Redraw chart
            drawChart();
        }

        function pauseSimulation() {
            gameState.isPaused = !gameState.isPaused;
            const pauseBtn = document.getElementById('pauseBtn');

            if (gameState.isPaused) {
                pauseBtn.textContent = '▶️ Resume';
            } else {
                pauseBtn.textContent = '⏸️ Pause';
            }
        }

        function setSpeed(speed) {
            gameState.simulationSpeed = speed;

            // Update active speed button
            document.querySelectorAll('.speed-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Restart simulation with new speed if currently running
            if (gameState.isTrading && gameState.intervalId) {
                startSimulation();
            }
        }

        // Mouse interaction for tooltip
        canvas.addEventListener('mousemove', function (e) {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            // Find nearest data point
            let nearestIndex = -1;
            let minDistance = Infinity;

            for (let i = 0; i <= gameState.currentCandleIndex; i++) {
                const x = indexToX(i);
                const distance = Math.abs(mouseX - x);
                if (distance < minDistance && distance < 20) {
                    minDistance = distance;
                    nearestIndex = i;
                }
            }

            if (nearestIndex >= 0) {
                const data = stockData[nearestIndex];
                tooltip.style.display = 'block';
                tooltip.style.left = (e.clientX + 10) + 'px';
                tooltip.style.top = (e.clientY - 10) + 'px';
                tooltip.innerHTML = `
            <strong>${data.time}</strong><br>
            Open: ₹${data.open}<br>
            High: ₹${data.high}<br>
            Low: ₹${data.low}<br>
            Close: ₹${data.close}<br>
            Volume: ${data.volume.toLocaleString()}
        `;
            } else {
                tooltip.style.display = 'none';
            }
        });

        canvas.addEventListener('mouseleave', function () {
            tooltip.style.display = 'none';
        });

        // Close modal when clicking outside
        document.getElementById('videoModal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeVideoModal();
            }
        });

        // Initialize the application
        window.addEventListener('load', function () {
            populateVideoList();
            updatePatternInfo();
            updateDefaultValues();
            drawChart();
        });

        // Initialize
        populateVideoList();
        updatePatternInfo();
        updateDefaultValues();
        drawChart();


    </script>
</body>

</html>